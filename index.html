<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Race Rocket Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #0f0f1e 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: #eee;
            min-height: 100vh;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* CRT Scanline Overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(255, 255, 255, 0.02) 2px,
                rgba(255, 255, 255, 0.02) 4px
            );
            pointer-events: none;
            z-index: 0;
        }

        .container::after {
            content: "";
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 10;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            opacity: 0.3;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        h1 {
            text-align: center;
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: glowPulse 2s ease-in-out infinite alternate;
        }

        @keyframes glowPulse {
            from { filter: drop-shadow(0 0 10px rgba(78, 205, 196, 0.5)); }
            to { filter: drop-shadow(0 0 20px rgba(255, 107, 107, 0.8)); }
        }

        .subtitle {
            text-align: center;
            color: #4ecdc4;
            margin-bottom: 40px;
            font-size: 1.1em;
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
        }

        .phase-indicator {
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .phase-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .phase-dot.active {
            background: #4ecdc4;
            box-shadow: 0 0 15px #4ecdc4;
            transform: scale(1.5);
        }

        .hidden {
            display: none !important;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .progress-title {
            color: #4ecdc4;
            font-size: 1.1em;
            margin-bottom: 15px;
            text-align: center;
        }

        .progress-bars {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .progress-item {
            flex: 1;
            min-width: 150px;
        }

        .progress-label {
            font-size: 0.9em;
            color: #aaa;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
        }

        .progress-fill.complete {
            width: 100%;
        }

        .check-icon {
            color: #4ecdc4;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .check-icon.visible {
            opacity: 1;
        }

        /* Validation Alert */
        .validation-alert {
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid #ff6b6b;
            border-radius: 10px;
            padding: 15px 20px;
            margin: 20px 0;
            text-align: center;
            color: #ff6b6b;
            font-weight: bold;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* PHASE 1 - Assembly Floor */
        .assembly-floor {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            min-height: 600px;
        }

        @media (max-width: 968px) {
            .assembly-floor {
                grid-template-columns: 1fr;
            }
        }

        .component-drawer {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .drawer-section {
            margin-bottom: 30px;
        }

        .drawer-title {
            color: #ff6b6b;
            font-size: 1.1em;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .component-option {
            background: rgba(78, 205, 196, 0.05);
            border: 2px solid rgba(78, 205, 196, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .component-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(78, 205, 196, 0.2), transparent);
            transition: left 0.5s;
        }

        .component-option:hover::before {
            left: 100%;
        }

        .component-option:hover {
            background: rgba(78, 205, 196, 0.15);
            border-color: rgba(78, 205, 196, 0.5);
            transform: translateX(8px) scale(1.02);
            box-shadow: -5px 0 20px rgba(78, 205, 196, 0.2);
        }

        .component-option.selected {
            background: rgba(78, 205, 196, 0.25);
            border-color: #4ecdc4;
            border-width: 3px;
            box-shadow: 0 0 25px rgba(78, 205, 196, 0.5), inset 0 0 20px rgba(78, 205, 196, 0.1);
            transform: translateX(8px);
        }

        .component-option.selected::after {
            content: "‚úì";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%) scale(0);
            color: #4ecdc4;
            font-size: 2em;
            font-weight: bold;
            animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes popIn {
            to { transform: translateY(-50%) scale(1); }
        }

        .option-name {
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 8px;
            font-size: 1.05em;
        }

        .option-description {
            font-size: 0.85em;
            color: #bbb;
            line-height: 1.4;
        }

        .option-tag {
            display: inline-block;
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.75em;
            margin-top: 8px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        /* Blueprint Drafting Table */
        .drafting-table {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(78, 205, 196, 0.3);
            border-radius: 15px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            backdrop-filter: blur(10px);
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 19px, rgba(78, 205, 196, 0.05) 19px, rgba(78, 205, 196, 0.05) 20px),
                repeating-linear-gradient(90deg, transparent, transparent 19px, rgba(78, 205, 196, 0.05) 19px, rgba(78, 205, 196, 0.05) 20px);
            box-shadow: inset 0 0 50px rgba(78, 205, 196, 0.1);
        }

        .drafting-table::before {
            content: 'BLUEPRINT SCHEMATIC';
            position: absolute;
            top: 15px;
            left: 20px;
            color: rgba(78, 205, 196, 0.3);
            font-size: 0.8em;
            letter-spacing: 2px;
        }

        .rocket-canvas {
            width: 100%;
            max-width: 600px;
            height: 600px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .rocket-part {
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            opacity: 0;
            transform: scale(0.5);
        }

        .rocket-part.visible {
            opacity: 1;
            transform: scale(1);
        }

        /* Rocket blueprint styles */
        .blueprint-main {
            fill: none;
            stroke: rgba(78, 205, 196, 0.8);
            stroke-width: 2;
            filter: drop-shadow(0 0 8px rgba(78, 205, 196, 0.4));
        }

        .blueprint-detail {
            fill: none;
            stroke: rgba(78, 205, 196, 0.5);
            stroke-width: 1;
        }

        .blueprint-panel {
            fill: rgba(78, 205, 196, 0.05);
            stroke: rgba(78, 205, 196, 0.6);
            stroke-width: 1.5;
        }

        .rivet {
            fill: rgba(78, 205, 196, 0.7);
        }

        .engine-detail {
            fill: rgba(255, 107, 107, 0.2);
            stroke: rgba(255, 107, 107, 0.8);
            stroke-width: 2;
            filter: drop-shadow(0 0 6px rgba(255, 107, 107, 0.4));
        }

        .engine-nozzle {
            fill: rgba(255, 107, 107, 0.3);
            stroke: rgba(255, 107, 107, 0.9);
            stroke-width: 1.5;
        }

        .fin-detail {
            fill: rgba(78, 205, 196, 0.1);
            stroke: rgba(78, 205, 196, 0.7);
            stroke-width: 1.5;
        }

        .booster-detail {
            fill: rgba(78, 205, 196, 0.08);
            stroke: rgba(78, 205, 196, 0.7);
            stroke-width: 2;
            filter: drop-shadow(0 0 5px rgba(78, 205, 196, 0.3));
        }

        /* Technical Callouts */
        .callout {
            opacity: 0;
            transition: all 0.5s ease;
        }

        .callout.visible {
            opacity: 1;
        }

        .callout-line {
            stroke: rgba(255, 107, 107, 0.6);
            stroke-width: 1.5;
            stroke-dasharray: 4, 4;
            animation: dash 20s linear infinite;
        }

        @keyframes dash {
            to { stroke-dashoffset: -1000; }
        }

        .callout-text {
            fill: #4ecdc4;
            font-size: 10px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .callout-label {
            fill: #ff6b6b;
            font-size: 10px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .callout-bg {
            fill: rgba(10, 14, 39, 0.95);
            stroke: rgba(78, 205, 196, 0.6);
            stroke-width: 1.5;
        }

        .assembly-status {
            margin-top: 30px;
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-text {
            color: #aaa;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .status-highlight {
            color: #4ecdc4;
            font-weight: bold;
        }

        /* PHASE 2 - Chemistry Lab */
        .chemistry-lab {
            /* Visibility controlled by .hidden class on parent */
        }

        .lab-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .lab-grid {
                grid-template-columns: 1fr;
            }
        }

        .molecule-shelf {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .shelf-title {
            color: #ff6b6b;
            font-size: 1.3em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        .molecule-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .molecule {
            background: rgba(78, 205, 196, 0.1);
            border: 2px solid rgba(78, 205, 196, 0.3);
            border-radius: 10px;
            padding: 15px;
            cursor: grab;
            transition: all 0.3s ease;
            text-align: center;
        }

        .molecule:active {
            cursor: grabbing;
        }

        .molecule:hover {
            background: rgba(78, 205, 196, 0.2);
            border-color: #4ecdc4;
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(78, 205, 196, 0.3);
        }

        .molecule.selected-for-drag {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
        }

        .molecule-formula {
            font-size: 1.3em;
            color: #4ecdc4;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .molecule-name {
            font-size: 0.85em;
            color: #ccc;
        }

        .reaction-burner {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border: 2px dashed rgba(255, 107, 107, 0.5);
            border-radius: 15px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            transition: all 0.3s ease;
        }

        .reaction-burner.drag-over {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.3) 0%, rgba(255, 255, 255, 0.1) 100%);
            border-color: #ff6b6b;
            transform: scale(1.02);
        }

        .drop-zone {
            width: 100%;
            padding: 40px;
            text-align: center;
            color: #aaa;
            font-size: 1.1em;
        }

        .reaction-display {
            text-align: center;
            width: 100%;
        }

        .reaction-equation {
            font-size: 2em;
            color: #4ecdc4;
            margin: 20px 0;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
        }

        .reaction-result {
            background: rgba(78, 205, 196, 0.1);
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
        }

        .result-label {
            color: #ff6b6b;
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* PHASE 3 - Launch */
        .launch-sequence {
            min-height: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .launch-animation {
            text-align: center;
            padding: 60px;
        }

        .rocket-launch {
            font-size: 5em;
            animation: rocketLaunch 3s ease-in-out;
        }

        @keyframes rocketLaunch {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-500px) scale(0.5); opacity: 0; }
        }

        .countdown {
            font-size: 3em;
            color: #ff6b6b;
            margin-top: 30px;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
        }

        .dossier {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }

        .comparison-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 25px;
        }

        .section-title {
            color: #ff6b6b;
            font-size: 1.2em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        .spec-line {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .spec-label {
            color: #aaa;
        }

        .spec-value {
            color: #4ecdc4;
            font-weight: bold;
        }

        .historical-context {
            background: rgba(255, 107, 107, 0.1);
            border-left: 4px solid #ff6b6b;
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
        }

        .context-title {
            color: #ff6b6b;
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a6a0 100%);
            color: #fff;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            font-family: 'Courier New', monospace;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
            font-weight: bold;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ SPACE RACE ROCKET BUILDER</h1>
        <div class="subtitle">Cold War Era Ballistic Missile Engineering Simulator</div>

        <div class="phase-indicator">
            <div class="phase-dot active" id="dot-1"></div>
            <div class="phase-dot" id="dot-2"></div>
            <div class="phase-dot" id="dot-3"></div>
        </div>

        <!-- PHASE 1: Assembly -->
        <div id="phase1">
            <!-- Progress Tracker -->
            <div class="progress-tracker">
                <div class="progress-title">üìä DESIGN PROGRESS</div>
                <div class="progress-bars">
                    <div class="progress-item">
                        <div class="progress-label">
                            <span>Structure</span>
                            <span class="check-icon" id="check-structure">‚úì</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-structure"></div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">
                            <span>Engine</span>
                            <span class="check-icon" id="check-engine">‚úì</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-engine"></div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">
                            <span>Deployment</span>
                            <span class="check-icon" id="check-deployment">‚úì</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-deployment"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="assembly-floor">
                <div class="component-drawer">
                    <div class="drawer-section">
                        <div class="drawer-title">
                            <span>üîß</span>
                            <span>STRUCTURAL CONFIGURATION</span>
                        </div>
                        <div class="component-option" data-category="structure" data-value="r7">
                            <div class="option-name">Clustered Strap-on Boosters</div>
                            <div class="option-description">4 liquid-fueled boosters around central core</div>
                            <div class="option-tag">USSR Design</div>
                        </div>
                        <div class="component-option" data-category="structure" data-value="atlas">
                            <div class="option-name">Balloon Tank Construction</div>
                            <div class="option-description">Pressurized ultra-thin steel shell (0.25mm)</div>
                            <div class="option-tag">USA Innovation</div>
                        </div>
                        <div class="component-option" data-category="structure" data-value="monolith">
                            <div class="option-name">Solid Monolith Body</div>
                            <div class="option-description">Unified single-stage pressure vessel</div>
                            <div class="option-tag">Standard Design</div>
                        </div>
                    </div>

                    <div class="drawer-section">
                        <div class="drawer-title">
                            <span>‚ö°</span>
                            <span>ENGINE ARCHITECTURE</span>
                        </div>
                        <div class="component-option" data-category="engine" data-value="vernier">
                            <div class="option-name">Multi-Chamber Vernier Thrusters</div>
                            <div class="option-description">Swiveling control nozzles for precision guidance</div>
                            <div class="option-tag">High Precision</div>
                        </div>
                        <div class="component-option" data-category="engine" data-value="stage-half">
                            <div class="option-name">Stage-and-a-Half Configuration</div>
                            <div class="option-description">Booster + sustainer combo ignition system</div>
                            <div class="option-tag">Efficiency Focus</div>
                        </div>
                        <div class="component-option" data-category="engine" data-value="single">
                            <div class="option-name">Static Single Nozzle</div>
                            <div class="option-description">Fixed-gimbal single engine design</div>
                            <div class="option-tag">Simplicity</div>
                        </div>
                    </div>

                    <div class="drawer-section">
                        <div class="drawer-title">
                            <span>üöõ</span>
                            <span>DEPLOYMENT METHOD</span>
                        </div>
                        <div class="component-option" data-category="deployment" data-value="silo">
                            <div class="option-name">Surface Pad / Silo Launch</div>
                            <div class="option-description">Fixed installation, complex fueling infrastructure</div>
                            <div class="option-tag">Strategic</div>
                        </div>
                        <div class="component-option" data-category="deployment" data-value="mobile">
                            <div class="option-name">Mobile Transport Erector</div>
                            <div class="option-description">Road-mobile launcher, rapid deployment</div>
                            <div class="option-tag">Tactical</div>
                        </div>
                    </div>
                </div>

                <div class="drafting-table">
                    <div class="rocket-canvas">
                        <svg width="600" height="600" viewBox="0 0 600 600" style="overflow: visible;" id="rocketSvg">
                            <!-- Nose Cone with Detail -->
                            <g class="rocket-part" id="nose">
                                <polygon class="blueprint-main" points="300,60 260,160 340,160"/>
                                <line class="blueprint-detail" x1="300" y1="60" x2="300" y2="160"/>
                                <line class="blueprint-detail" x1="270" y1="100" x2="330" y2="100"/>
                                <line class="blueprint-detail" x1="265" y1="130" x2="335" y2="130"/>
                            </g>
                            
                            <!-- Main Body with Panels and Rivets -->
                            <g class="rocket-part" id="body">
                                <!-- Outer shell -->
                                <rect class="blueprint-main" x="260" y="160" width="80" height="280" rx="3"/>
                                
                                <!-- Panel lines (horizontal sections) -->
                                <line class="blueprint-detail" x1="260" y1="210" x2="340" y2="210"/>
                                <line class="blueprint-detail" x1="260" y1="260" x2="340" y2="260"/>
                                <line class="blueprint-detail" x1="260" y1="310" x2="340" y2="310"/>
                                <line class="blueprint-detail" x1="260" y1="360" x2="340" y2="360"/>
                                <line class="blueprint-detail" x1="260" y1="410" x2="340" y2="410"/>
                                
                                <!-- Vertical seams -->
                                <line class="blueprint-detail" x1="280" y1="160" x2="280" y2="440"/>
                                <line class="blueprint-detail" x1="320" y1="160" x2="320" y2="440"/>
                                
                                <!-- Rivets along seams -->
                                <circle class="rivet" cx="280" cy="180" r="1.5"/>
                                <circle class="rivet" cx="280" cy="220" r="1.5"/>
                                <circle class="rivet" cx="280" cy="260" r="1.5"/>
                                <circle class="rivet" cx="280" cy="300" r="1.5"/>
                                <circle class="rivet" cx="280" cy="340" r="1.5"/>
                                <circle class="rivet" cx="280" cy="380" r="1.5"/>
                                <circle class="rivet" cx="280" cy="420" r="1.5"/>
                                
                                <circle class="rivet" cx="320" cy="180" r="1.5"/>
                                <circle class="rivet" cx="320" cy="220" r="1.5"/>
                                <circle class="rivet" cx="320" cy="260" r="1.5"/>
                                <circle class="rivet" cx="320" cy="300" r="1.5"/>
                                <circle class="rivet" cx="320" cy="340" r="1.5"/>
                                <circle class="rivet" cx="320" cy="380" r="1.5"/>
                                <circle class="rivet" cx="320" cy="420" r="1.5"/>
                                
                                <!-- Fuel tank indicator -->
                                <rect class="blueprint-panel" x="265" y="220" width="70" height="80" rx="2"/>
                            </g>
                            
                            <!-- Fins -->
                            <g class="rocket-part" id="fins">
                                <polygon class="fin-detail" points="340,380 360,440 340,440"/>
                                <polygon class="fin-detail" points="260,380 240,440 260,440"/>
                                <!-- Fin structure lines -->
                                <line class="blueprint-detail" x1="340" y1="380" x2="355" y2="425"/>
                                <line class="blueprint-detail" x1="260" y1="380" x2="245" y2="425"/>
                            </g>
                            
                            <!-- Engine Section with Detailed Nozzle -->
                            <g class="rocket-part" id="engine">
                                <!-- Engine mount -->
                                <rect class="engine-detail" x="265" y="440" width="70" height="30" rx="3"/>
                                
                                <!-- Main nozzle bell -->
                                <path class="engine-nozzle" d="M 270 470 L 265 485 L 270 495 L 280 500 L 320 500 L 330 495 L 335 485 L 330 470 Z"/>
                                
                                <!-- Inner nozzle detail -->
                                <path class="blueprint-detail" d="M 275 475 L 272 485 L 275 492 L 285 495 L 315 495 L 325 492 L 328 485 L 325 475"/>
                                
                                <!-- Gimbal mount indicators -->
                                <circle class="rivet" cx="265" cy="455" r="2"/>
                                <circle class="rivet" cx="335" cy="455" r="2"/>
                                
                                <!-- Injector plate detail -->
                                <line class="blueprint-detail" x1="270" y1="445" x2="330" y2="445"/>
                                <circle class="rivet" cx="285" cy="445" r="1"/>
                                <circle class="rivet" cx="300" cy="445" r="1"/>
                                <circle class="rivet" cx="315" cy="445" r="1"/>
                                
                                <!-- Thrust chamber cooling channels -->
                                <line class="blueprint-detail" x1="275" y1="470" x2="275" y2="490"/>
                                <line class="blueprint-detail" x1="285" y1="470" x2="283" y2="492"/>
                                <line class="blueprint-detail" x1="295" y1="470" x2="293" y2="494"/>
                                <line class="blueprint-detail" x1="305" y1="470" x2="307" y2="494"/>
                                <line class="blueprint-detail" x1="315" y1="470" x2="317" y2="492"/>
                                <line class="blueprint-detail" x1="325" y1="470" x2="325" y2="490"/>
                            </g>
                            
                            <!-- Strap-on Boosters (Left) -->
                            <g class="rocket-part" id="booster-left">
                                <!-- Booster body -->
                                <rect class="booster-detail" x="190" y="220" width="50" height="200" rx="3"/>
                                
                                <!-- Panel lines -->
                                <line class="blueprint-detail" x1="190" y1="270" x2="240" y2="270"/>
                                <line class="blueprint-detail" x1="190" y1="320" x2="240" y2="320"/>
                                <line class="blueprint-detail" x1="190" y1="370" x2="240" y2="370"/>
                                
                                <!-- Vertical seam -->
                                <line class="blueprint-detail" x1="215" y1="220" x2="215" y2="420"/>
                                
                                <!-- Rivets -->
                                <circle class="rivet" cx="215" cy="240" r="1.5"/>
                                <circle class="rivet" cx="215" cy="280" r="1.5"/>
                                <circle class="rivet" cx="215" cy="330" r="1.5"/>
                                <circle class="rivet" cx="215" cy="380" r="1.5"/>
                                
                                <!-- Booster nozzle -->
                                <path class="engine-nozzle" d="M 195 420 L 192 430 L 195 437 L 205 440 L 225 440 L 235 437 L 238 430 L 235 420 Z"/>
                                
                                <!-- Attach strut to main body -->
                                <line class="blueprint-detail" x1="240" y1="280" x2="260" y2="280"/>
                                <line class="blueprint-detail" x1="240" y1="360" x2="260" y2="360"/>
                            </g>
                            
                            <!-- Strap-on Boosters (Right) -->
                            <g class="rocket-part" id="booster-right">
                                <!-- Booster body -->
                                <rect class="booster-detail" x="360" y="220" width="50" height="200" rx="3"/>
                                
                                <!-- Panel lines -->
                                <line class="blueprint-detail" x1="360" y1="270" x2="410" y2="270"/>
                                <line class="blueprint-detail" x1="360" y1="320" x2="410" y2="320"/>
                                <line class="blueprint-detail" x1="360" y1="370" x2="410" y2="370"/>
                                
                                <!-- Vertical seam -->
                                <line class="blueprint-detail" x1="385" y1="220" x2="385" y2="420"/>
                                
                                <!-- Rivets -->
                                <circle class="rivet" cx="385" cy="240" r="1.5"/>
                                <circle class="rivet" cx="385" cy="280" r="1.5"/>
                                <circle class="rivet" cx="385" cy="330" r="1.5"/>
                                <circle class="rivet" cx="385" cy="380" r="1.5"/>
                                
                                <!-- Booster nozzle -->
                                <path class="engine-nozzle" d="M 365 420 L 362 430 L 365 437 L 375 440 L 395 440 L 405 437 L 408 430 L 405 420 Z"/>
                                
                                <!-- Attach strut to main body -->
                                <line class="blueprint-detail" x1="340" y1="280" x2="360" y2="280"/>
                                <line class="blueprint-detail" x1="340" y1="360" x2="360" y2="360"/>
                            </g>
                            
                            <!-- Callout: Structure (Top Left) -->
                            <g class="callout" id="callout-structure">
                                <line class="callout-line" x1="240" y1="280" x2="120" y2="220"/>
                                <rect class="callout-bg" x="15" y="200" width="100" height="40" rx="3"/>
                                <text class="callout-text" x="20" y="215">STRUCTURE:</text>
                                <text class="callout-label" x="20" y="230" id="structure-label">None</text>
                            </g>
                            
                            <!-- Callout: Engine (Bottom Center) -->
                            <g class="callout" id="callout-engine">
                                <line class="callout-line" x1="300" y1="500" x2="300" y2="550"/>
                                <rect class="callout-bg" x="250" y="555" width="100" height="40" rx="3"/>
                                <text class="callout-text" x="255" y="570">ENGINE:</text>
                                <text class="callout-label" x="255" y="585" id="engine-label">None</text>
                            </g>
                            
                            <!-- Callout: Deployment (Top Right) -->
                            <g class="callout" id="callout-deployment">
                                <line class="callout-line" x1="360" y1="320" x2="480" y2="260"/>
                                <rect class="callout-bg" x="485" y="240" width="100" height="40" rx="3"/>
                                <text class="callout-text" x="490" y="255">DEPLOYMENT:</text>
                                <text class="callout-label" x="490" y="270" id="deployment-label">None</text>
                            </g>
                        </svg>
                        
                        <div class="assembly-status">
                            <div class="status-text" id="statusText">
                                Select components from the left panel to begin assembly
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PHASE 2: Fuel Selection -->
        <div id="phase2" class="hidden">
            <div class="chemistry-lab">
                <h2 style="text-align: center; color: #4ecdc4; margin-bottom: 30px;">
                    ‚öóÔ∏è PROPELLANT CHEMISTRY LAB
                </h2>
                
                <div class="lab-grid">
                    <!-- Fuel Shelf -->
                    <div class="molecule-shelf">
                        <div class="shelf-title">FUEL COMPOUNDS</div>
                        <div class="molecule-grid">
                            <div class="molecule" draggable="true" data-type="fuel" data-value="rp1">
                                <div class="molecule-formula">RP-1</div>
                                <div class="molecule-name">Refined Kerosene</div>
                            </div>
                            <div class="molecule" draggable="true" data-type="fuel" data-value="hydrogen">
                                <div class="molecule-formula">LH‚ÇÇ</div>
                                <div class="molecule-name">Liquid Hydrogen</div>
                            </div>
                            <div class="molecule" draggable="true" data-type="fuel" data-value="hydrazine">
                                <div class="molecule-formula">N‚ÇÇH‚ÇÑ</div>
                                <div class="molecule-name">Hydrazine</div>
                            </div>
                        </div>
                    </div>

                    <!-- Oxidizer Shelf -->
                    <div class="molecule-shelf">
                        <div class="shelf-title">OXIDIZER COMPOUNDS</div>
                        <div class="molecule-grid">
                            <div class="molecule" draggable="true" data-type="oxidizer" data-value="lox">
                                <div class="molecule-formula">LOX</div>
                                <div class="molecule-name">Liquid Oxygen</div>
                            </div>
                            <div class="molecule" draggable="true" data-type="oxidizer" data-value="tetroxide">
                                <div class="molecule-formula">N‚ÇÇO‚ÇÑ</div>
                                <div class="molecule-name">Nitrogen Tetroxide</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reaction Burner -->
                <div class="reaction-burner">
                    <div class="drop-zone" id="dropZone">
                        <div style="font-size: 1.5em; margin-bottom: 15px;">üî•</div>
                        <div>Drag fuel + oxidizer here to test reaction</div>
                        <div style="margin-top: 15px; font-size: 0.9em; color: #666;">
                            (Or click to select on mobile)
                        </div>
                    </div>
                    
                    <div class="reaction-display hidden" id="reactionDisplay">
                        <!-- Reaction results will appear here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- PHASE 3: Launch & Results -->
        <div id="phase3" class="hidden">
            <div class="launch-sequence">
                <div class="launch-animation" id="launchAnim">
                    <div class="rocket-launch">üöÄ</div>
                    <div class="countdown">LAUNCHING...</div>
                </div>

                <div class="dossier hidden" id="dossierSection">
                    <div id="matchResult"></div>
                    <div class="comparison-grid" id="comparisonGrid"></div>
                    <div class="historical-context" id="historicalContext"></div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-buttons">
            <button id="backBtn" class="hidden">‚Üê Back</button>
            <button id="nextBtn" disabled>Next Phase ‚Üí</button>
            <button id="launchBtn" class="hidden btn-danger">üöÄ LAUNCH SEQUENCE</button>
            <button id="resetBtn" class="hidden">üîÑ Build Another Rocket</button>
        </div>
    </div>

    <script>
        // State Management
        const state = {
            currentPhase: 1,
            selections: {
                structure: null,
                engine: null,
                deployment: null
            },
            fuel: null,
            oxidizer: null,
            fuelType: null,
            testedReaction: false
        };

        // Rocket Database
        const rocketDatabase = {
            r7: {
                name: "R-7 Semyorka",
                designation: "8K71",
                nation: "USSR",
                year: "1957",
                matchMessage: "Your clustered booster design with RP-1/LOX propellant matches the iconic R-7 Semyorka - the world's first ICBM and the launcher that put Sputnik into orbit. This revolutionary design used four strap-on boosters around a central core, creating the distinctive 'Korolev Cross' pattern during stage separation.",
                specs: {
                    "Height": "34m (111 ft)",
                    "Diameter": "10.3m at base",
                    "Mass": "280,000 kg",
                    "Thrust": "3,900 kN",
                    "Range": "8,800 km",
                    "Propellant": "RP-1 / LOX"
                },
                description: "The R-7 was designed by Sergei Korolev's OKB-1 design bureau. Its clustered booster configuration became the template for all Soviet/Russian space launchers, from Vostok to modern Soyuz. The rocket used four RD-107 engines on the boosters and one RD-108 on the core, all featuring innovative vernier thrusters for precise control.",
                historicalContext: "Designed as an ICBM to deliver nuclear warheads to the United States, the R-7 was too expensive and complex for military deployment. However, it found its true calling as a space launcher. On October 4, 1957, a modified R-7 launched Sputnik 1, shocking the world and beginning the Space Age. Its derivatives have launched over 1,900 missions - more than any other rocket family in history."
            },
            atlas: {
                name: "SM-65 Atlas",
                designation: "Atlas D",
                nation: "USA",
                year: "1959",
                matchMessage: "Your balloon tank construction with stage-and-a-half engine configuration matches the revolutionary SM-65 Atlas - America's first operational ICBM. The Atlas pioneered the use of pressurized 'balloon tanks' so thin they would collapse without internal pressure, achieving incredible mass savings.",
                specs: {
                    "Height": "22.9m (75 ft)",
                    "Diameter": "3.05m (10 ft)",
                    "Mass": "120,000 kg",
                    "Thrust": "1,600 kN",
                    "Range": "14,500 km",
                    "Propellant": "RP-1 / LOX"
                },
                description: "Designed by Convair under the brilliant engineer Karel Bossart, the Atlas used a revolutionary 'stage-and-a-half' configuration. Two booster engines and one sustainer engine ignited at liftoff. At staging, the boosters dropped away while the sustainer continued - eliminating the weight penalty of traditional staging. The stainless steel balloon tanks were only 0.25mm thick.",
                historicalContext: "The Atlas served as America's primary ICBM deterrent from 1959-1965. More importantly, it became the workhorse of early American space exploration. Atlas rockets launched John Glenn's historic Friendship 7 mission in 1962 (America's first orbital flight), all four Mercury orbital missions, and hundreds of satellites. Atlas-Centaur variants remain in service today."
            },
            r12: {
                name: "R-12 Dvina",
                designation: "SS-4 Sandal",
                nation: "USSR",
                year: "1959",
                matchMessage: "Your monolithic structure with storable hypergolic propellants matches the R-12 Dvina - the Soviet Union's most deployed theater ballistic missile. The R-12 revolutionized missile doctrine by using storable propellants that could remain fueled for months, enabling rapid launch readiness.",
                specs: {
                    "Height": "22.8m (74.8 ft)",
                    "Diameter": "1.65m (5.4 ft)",
                    "Mass": "42,000 kg",
                    "Thrust": "740 kN",
                    "Range": "2,000 km",
                    "Propellant": "UDMH / N‚ÇÇO‚ÇÑ"
                },
                description: "Designed by Mikhail Yangel's OKB-586, the R-12 was the Soviet Union's answer to medium-range nuclear delivery. Unlike the cryogenic R-7, the R-12 used storable hypergolic propellants (Unsymmetrical Dimethylhydrazine and Nitrogen Tetroxide) that ignite on contact, requiring no ignition system. This made the missile simpler and more reliable for military operations.",
                historicalContext: "The R-12 became infamous during the Cuban Missile Crisis of October 1962. Soviet forces secretly deployed 36 R-12 missiles to Cuba, each capable of reaching most U.S. cities with nuclear warheads. Their discovery by U-2 reconnaissance triggered the most dangerous confrontation of the Cold War. The crisis was resolved when the USSR agreed to remove the missiles in exchange for the secret removal of U.S. Jupiter missiles from Turkey."
            },
            jupiter: {
                name: "PGM-19 Jupiter",
                designation: "SM-78",
                nation: "USA",
                year: "1958",
                matchMessage: "Your mobile deployment system with monolithic structure matches the PGM-19 Jupiter - the U.S. Army's mobile medium-range ballistic missile. Jupiter pioneered the use of mobile launchers for rapid deployment, though its RP-1 fuel limited its readiness compared to storable-fuel missiles.",
                specs: {
                    "Height": "18.3m (60 ft)",
                    "Diameter": "2.67m (8.75 ft)",
                    "Mass": "50,000 kg",
                    "Thrust": "667 kN",
                    "Range": "2,400 km",
                    "Propellant": "RP-1 / LOX"
                },
                description: "Developed by the U.S. Army Ballistic Missile Agency under Wernher von Braun (the former V-2 rocket engineer), Jupiter was designed for mobile deployment on road-transportable trailers. The missile used a single Rocketdyne LR79 engine burning RP-1 and liquid oxygen. Despite its mobile design, the cryogenic LOX required fueling shortly before launch.",
                historicalContext: "Deployed to Italy and Turkey from 1961-1963, Jupiter missiles were positioned to strike Soviet territory. These 15 Jupiter missiles in Turkey became a secret bargaining chip during the Cuban Missile Crisis. While the public agreement focused on removing Soviet missiles from Cuba, President Kennedy secretly agreed to withdraw the Jupiters from Turkey within six months. This secret deal remained classified for decades, shaping Cold War nuclear strategy."
            }
        };

        // Chemistry Reactions Database
        const reactions = {
            "rp1-lox": {
                equation: "RP-1 + LOX ‚Üí CO‚ÇÇ + H‚ÇÇO + Thrust",
                type: "rp1",
                performance: "High Thrust",
                isp: "~300s (sea level), ~350s (vacuum)",
                storability: "LOX is cryogenic (-183¬∞C), requires fueling shortly before launch",
                advantages: "Dense, high thrust, well-tested technology",
                disadvantages: "Cryogenic oxidizer, lower specific impulse than hydrogen",
                usedBy: "R-7 Semyorka, Atlas, Saturn I, Falcon 9, most early rockets"
            },
            "hydrogen-lox": {
                equation: "LH‚ÇÇ + LOX ‚Üí H‚ÇÇO + Thrust",
                type: "hydrogen",
                performance: "Highest Efficiency",
                isp: "~380s (sea level), ~450s (vacuum)",
                storability: "Both cryogenic (LH‚ÇÇ at -253¬∞C, LOX at -183¬∞C)",
                advantages: "Highest specific impulse of any chemical propellant, clean exhaust",
                disadvantages: "Very low density requires huge tanks, difficult to handle, boil-off",
                usedBy: "Saturn V upper stages, Space Shuttle main engines, Delta IV, SLS"
            },
            "hydrazine-tetroxide": {
                equation: "N‚ÇÇH‚ÇÑ + N‚ÇÇO‚ÇÑ ‚Üí N‚ÇÇ + H‚ÇÇO + Thrust",
                type: "hypergolic",
                performance: "Moderate Thrust",
                isp: "~270s (sea level), ~340s (vacuum)",
                storability: "Both storable at room temperature for months/years",
                advantages: "Hypergolic (self-igniting), storable, instant readiness, reliable",
                disadvantages: "Highly toxic, corrosive, lower performance than LOX-based fuels",
                usedBy: "R-12 Dvina, Titan II, Proton, Long March 2-4, Dragon spacecraft"
            }
        };

        // Callout labels mapping
        const calloutLabels = {
            structure: {
                r7: "Clustered Boosters",
                atlas: "Balloon Tanks",
                monolith: "Monolith Body"
            },
            engine: {
                vernier: "Vernier Control",
                'stage-half': "Stage-and-Half",
                single: "Single Nozzle"
            },
            deployment: {
                silo: "Silo Launch",
                mobile: "Mobile Platform"
            }
        };

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            initSelection();
            initChemistry();
            initNavigation();
            updateRocketVisualization();
        });

        // PHASE 1: Component Selection
        function initSelection() {
            const options = document.querySelectorAll('.component-option');
            
            options.forEach(option => {
                option.addEventListener('click', () => {
                    const category = option.dataset.category;
                    const value = option.dataset.value;
                    
                    // Deselect other options in same category
                    document.querySelectorAll(`[data-category="${category}"]`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Select this option
                    option.classList.add('selected');
                    state.selections[category] = value;
                    
                    // Update progress bar
                    updateProgressBar(category);
                    
                    // Update callout label
                    updateCallout(category, value);
                    
                    // Update visualization
                    updateRocketVisualization();
                    
                    // Update status text
                    updateStatusText();
                    
                    // Check if all selections made
                    validatePhase1();
                });
            });
        }

        function updateProgressBar(category) {
            const progressFill = document.getElementById(`progress-${category}`);
            const checkIcon = document.getElementById(`check-${category}`);
            
            progressFill.classList.add('complete');
            checkIcon.classList.add('visible');
        }

        function updateCallout(category, value) {
            const callout = document.getElementById(`callout-${category}`);
            const label = document.getElementById(`${category}-label`);
            
            callout.classList.add('visible');
            label.textContent = calloutLabels[category][value];
        }

        function updateStatusText() {
            const { structure, engine, deployment } = state.selections;
            const statusText = document.getElementById('statusText');
            
            const selected = [structure, engine, deployment].filter(Boolean).length;
            
            if (selected === 0) {
                statusText.innerHTML = 'Select components from the left panel to begin assembly';
            } else if (selected === 1) {
                statusText.innerHTML = `<span class="status-highlight">${selected}/3</span> components selected. Keep going!`;
            } else if (selected === 2) {
                statusText.innerHTML = `<span class="status-highlight">${selected}/3</span> components selected. One more to go!`;
            } else {
                statusText.innerHTML = `<span class="status-highlight">‚úì All systems configured!</span> Ready to proceed to propellant selection.`;
            }
        }

        function validatePhase1() {
            const { structure, engine, deployment } = state.selections;
            const nextBtn = document.getElementById('nextBtn');
            
            if (structure && engine && deployment) {
                nextBtn.disabled = false;
                // Remove any existing alert
                const existingAlert = document.querySelector('.validation-alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
            } else {
                nextBtn.disabled = true;
            }
        }

        function updateRocketVisualization() {
            // Show basic rocket parts with staggered timing
            setTimeout(() => document.getElementById('nose').classList.add('visible'), 100);
            setTimeout(() => document.getElementById('body').classList.add('visible'), 200);
            setTimeout(() => document.getElementById('fins').classList.add('visible'), 300);
            setTimeout(() => document.getElementById('engine').classList.add('visible'), 400);
            
            // Show boosters for clustered configuration
            const boosterLeft = document.getElementById('booster-left');
            const boosterRight = document.getElementById('booster-right');
            
            if (state.selections.structure === 'r7') {
                setTimeout(() => {
                    boosterLeft.classList.add('visible');
                    boosterRight.classList.add('visible');
                }, 500);
            } else {
                boosterLeft.classList.remove('visible');
                boosterRight.classList.remove('visible');
            }
        }

        // PHASE 2: Chemistry Lab
        function initChemistry() {
            const molecules = document.querySelectorAll('.molecule');
            const dropZone = document.getElementById('dropZone');
            
            // Drag and Drop for desktop
            molecules.forEach(molecule => {
                molecule.addEventListener('dragstart', handleDragStart);
                molecule.addEventListener('dragend', handleDragEnd);
            });
            
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('dragleave', handleDragLeave);
            dropZone.addEventListener('drop', handleDrop);
            
            // Click to select for mobile
            molecules.forEach(molecule => {
                molecule.addEventListener('click', () => {
                    const type = molecule.dataset.type;
                    const value = molecule.dataset.value;
                    
                    // Remove previous selection of same type
                    document.querySelectorAll(`[data-type="${type}"]`).forEach(m => {
                        m.classList.remove('selected-for-drag');
                    });
                    
                    molecule.classList.add('selected-for-drag');
                    
                    if (type === 'fuel') {
                        state.fuel = value;
                    } else {
                        state.oxidizer = value;
                    }
                    
                    // Test reaction if both are selected
                    if (state.fuel && state.oxidizer) {
                        testReaction();
                    }
                });
            });
        }

        function handleDragStart(e) {
            const type = this.dataset.type;
            const value = this.dataset.value;
            e.dataTransfer.setData('type', type);
            e.dataTransfer.setData('value', value);
            this.style.opacity = '0.5';
        }

        function handleDragEnd(e) {
            this.style.opacity = '1';
        }

        function handleDragOver(e) {
            e.preventDefault();
            document.querySelector('.reaction-burner').classList.add('drag-over');
        }

        function handleDragLeave(e) {
            document.querySelector('.reaction-burner').classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            document.querySelector('.reaction-burner').classList.remove('drag-over');
            
            const type = e.dataTransfer.getData('type');
            const value = e.dataTransfer.getData('value');
            
            if (type === 'fuel') {
                state.fuel = value;
            } else if (type === 'oxidizer') {
                state.oxidizer = value;
            }
            
            // Highlight the dropped molecule
            document.querySelectorAll(`[data-value="${value}"]`).forEach(m => {
                m.classList.add('selected-for-drag');
            });
            
            // Test reaction if both components present
            if (state.fuel && state.oxidizer) {
                testReaction();
            }
        }

        function testReaction() {
            const reactionKey = `${state.fuel}-${state.oxidizer}`;
            const reaction = reactions[reactionKey];
            
            if (!reaction) {
                // Invalid combination - show warning
                const dropZone = document.getElementById('dropZone');
                dropZone.innerHTML = `
                    <div style="color: #ff6b6b; font-size: 1.2em;">
                        ‚ö†Ô∏è CHEMICAL INSTABILITY DETECTED
                    </div>
                    <div style="margin-top: 15px; color: #aaa;">
                        This combination won't produce a stable reaction.
                        <br>Try a different fuel/oxidizer pair.
                    </div>
                    <button onclick="resetReaction()" style="margin-top: 20px;">Try Again</button>
                `;
                return;
            }
            
            // Valid reaction - show results
            state.fuelType = reaction.type;
            
            const reactionDisplay = document.getElementById('reactionDisplay');
            const dropZone = document.getElementById('dropZone');
            
            dropZone.classList.add('hidden');
            reactionDisplay.classList.remove('hidden');
            
            reactionDisplay.innerHTML = `
                <div class="reaction-equation">${reaction.equation}</div>
                <div class="reaction-result">
                    <div class="result-label">‚ö° Performance:</div>
                    <div style="margin-bottom: 15px;">${reaction.performance}</div>
                    
                    <div class="result-label">üìä Specific Impulse (Isp):</div>
                    <div style="margin-bottom: 15px;">${reaction.isp}</div>
                    
                    <div class="result-label">üß™ Storability:</div>
                    <div style="margin-bottom: 15px;">${reaction.storability}</div>
                    
                    <div class="result-label">‚úÖ Advantages:</div>
                    <div style="margin-bottom: 15px; color: #4ecdc4;">${reaction.advantages}</div>
                    
                    <div class="result-label">‚ö†Ô∏è Disadvantages:</div>
                    <div style="margin-bottom: 15px; color: #ff6b6b;">${reaction.disadvantages}</div>
                    
                    <div class="result-label">üöÄ Historical Use:</div>
                    <div style="color: #aaa;">${reaction.usedBy}</div>
                </div>
                <button onclick="resetReaction()" style="margin-top: 20px; padding: 10px 30px;">Test Another Reaction</button>
            `;
            
            state.testedReaction = true;
            
            // Enable launch button
            const launchBtn = document.getElementById('launchBtn');
            launchBtn.classList.remove('hidden');
            launchBtn.disabled = false;
        }

        function resetReaction() {
            state.fuel = null;
            state.oxidizer = null;
            state.fuelType = null;
            state.testedReaction = false;
            
            // Clear selections
            document.querySelectorAll('.molecule').forEach(m => {
                m.classList.remove('selected-for-drag');
            });
            
            const reactionDisplay = document.getElementById('reactionDisplay');
            const dropZone = document.getElementById('dropZone');
            
            reactionDisplay.classList.add('hidden');
            dropZone.classList.remove('hidden');
            dropZone.innerHTML = `
                <div style="font-size: 1.5em; margin-bottom: 15px;">üî•</div>
                <div>Drag fuel + oxidizer here to test reaction</div>
                <div style="margin-top: 15px; font-size: 0.9em; color: #666;">
                    (Or click to select on mobile)
                </div>
            `;
            
            document.getElementById('launchBtn').classList.add('hidden');
        }

        // PHASE 3: Launch & Results
        function launchRocket() {
            goToPhase(3);
            
            setTimeout(() => {
                showDossier();
            }, 3500);
        }

        function showDossier() {
            const launchAnim = document.getElementById('launchAnim');
            const dossierSection = document.getElementById('dossierSection');
            
            launchAnim.style.display = 'none';
            dossierSection.classList.remove('hidden');
            
            // Determine which rocket was built
            const rocketKey = determineRocket();
            const rocket = rocketDatabase[rocketKey];
            
            // Show match result
            const matchResult = document.getElementById('matchResult');
            matchResult.innerHTML = `
                <div style="text-align: center; padding: 30px; background: rgba(78, 205, 196, 0.1); border-radius: 10px; margin-bottom: 30px;">
                    <h3 style="color: #4ecdc4; font-size: 1.5em; margin-bottom: 15px;">üéØ INTELLIGENCE MATCH CONFIRMED</h3>
                    <p style="font-size: 1.3em; color: #fff; margin-bottom: 20px;">You have built: <strong style="color: #ff6b6b;">${rocket.name}</strong></p>
                    <p style="color: #aaa; margin-bottom: 25px;">${rocket.designation} ‚Ä¢ ${rocket.nation} ‚Ä¢ ${rocket.year}</p>
                    <div style="background: rgba(255, 107, 107, 0.15); padding: 20px; border-radius: 8px; border-left: 4px solid #ff6b6b;">
                        <p style="font-size: 1.1em; line-height: 1.7; color: #eee;">${rocket.matchMessage}</p>
                    </div>
                </div>
            `;
            
            // Show comparison
            const comparisonGrid = document.getElementById('comparisonGrid');
            comparisonGrid.innerHTML = `
                <div class="comparison-section">
                    <div class="section-title">üìã Your Design Choices</div>
                    ${createChoicesList()}
                </div>
                <div class="comparison-section">
                    <div class="section-title">üìä Actual Specifications</div>
                    ${createSpecsList(rocket.specs)}
                </div>
            `;
            
            // Add description
            const descSection = document.createElement('div');
            descSection.style.cssText = 'background: rgba(255, 255, 255, 0.03); border-radius: 10px; padding: 25px; margin-top: 30px; grid-column: 1 / -1;';
            descSection.innerHTML = `
                <div class="section-title">üîß Technical Description</div>
                <p style="line-height: 1.8; color: #ccc; margin-top: 15px;">${rocket.description}</p>
            `;
            comparisonGrid.appendChild(descSection);
            
            // Show historical context
            const historicalContext = document.getElementById('historicalContext');
            historicalContext.innerHTML = `
                <div class="context-title">üìú HISTORICAL SIGNIFICANCE</div>
                <p style="line-height: 1.8; margin-top: 10px;">${rocket.historicalContext}</p>
            `;
            
            document.getElementById('resetBtn').classList.remove('hidden');
        }

        function determineRocket() {
            const { structure, engine, deployment } = state.selections;
            const fuelType = state.fuelType;
            
            // R-7 Semyorka: Clustered structure + RP-1 fuel
            if (structure === 'r7' && fuelType === 'rp1') {
                return 'r7';
            }
            
            // SM-65 Atlas: Balloon tanks + Stage-and-a-half engine
            if (structure === 'atlas' && engine === 'stage-half') {
                return 'atlas';
            }
            
            // R-12 Dvina: Monolith + Storable/Hypergolic fuel
            if (structure === 'monolith' && fuelType === 'hypergolic') {
                return 'r12';
            }
            
            // PGM-19 Jupiter: Monolith + RP-1 + Mobile deployment
            if (structure === 'monolith' && fuelType === 'rp1' && deployment === 'mobile') {
                return 'jupiter';
            }
            
            // Fallback logic for partial matches
            if (structure === 'r7') return 'r7';
            if (structure === 'atlas') return 'atlas';
            if (fuelType === 'hypergolic') return 'r12';
            if (deployment === 'mobile' && structure === 'monolith') return 'jupiter';
            
            // Default
            return 'r7';
        }

        function createChoicesList() {
            const structureNames = {
                r7: 'Clustered Strap-on Boosters',
                atlas: 'Balloon Tank Construction',
                monolith: 'Solid Monolith Body'
            };
            const engineNames = {
                vernier: 'Multi-Chamber Vernier Thrusters',
                'stage-half': 'Stage-and-a-Half Configuration',
                single: 'Static Single Nozzle'
            };
            const deploymentNames = {
                silo: 'Surface Pad / Silo Launch',
                mobile: 'Mobile Transport Erector'
            };
            const fuelNames = {
                rp1: 'RP-1 / LOX (Kerosene + Liquid Oxygen)',
                hydrogen: 'LH‚ÇÇ / LOX (Liquid Hydrogen + Liquid Oxygen)',
                hypergolic: 'Storable Hypergolic (Hydrazine + N‚ÇÇO‚ÇÑ)'
            };
            
            return `
                <div class="spec-line">
                    <span class="spec-label">Structure:</span>
                    <span class="spec-value">${structureNames[state.selections.structure]}</span>
                </div>
                <div class="spec-line">
                    <span class="spec-label">Engine:</span>
                    <span class="spec-value">${engineNames[state.selections.engine]}</span>
                </div>
                <div class="spec-line">
                    <span class="spec-label">Fuel Type:</span>
                    <span class="spec-value">${fuelNames[state.fuelType]}</span>
                </div>
                <div class="spec-line">
                    <span class="spec-label">Deployment:</span>
                    <span class="spec-value">${deploymentNames[state.selections.deployment]}</span>
                </div>
            `;
        }

        function createSpecsList(specs) {
            return Object.entries(specs).map(([key, value]) => `
                <div class="spec-line">
                    <span class="spec-label">${key}:</span>
                    <span class="spec-value">${value}</span>
                </div>
            `).join('');
        }

        // Navigation
        function initNavigation() {
            const nextBtn = document.getElementById('nextBtn');
            const backBtn = document.getElementById('backBtn');
            const launchBtn = document.getElementById('launchBtn');
            const resetBtn = document.getElementById('resetBtn');
            
            nextBtn.addEventListener('click', () => {
                // Validate before proceeding
                if (state.currentPhase === 1) {
                    const { structure, engine, deployment } = state.selections;
                    if (!structure || !engine || !deployment) {
                        // Show validation alert
                        let alert = document.querySelector('.validation-alert');
                        if (!alert) {
                            alert = document.createElement('div');
                            alert.className = 'validation-alert';
                            alert.textContent = '‚ö†Ô∏è Please select all components before proceeding to the chemistry lab!';
                            document.querySelector('.assembly-floor').before(alert);
                        }
                        return;
                    }
                }
                
                if (state.currentPhase < 3) {
                    goToPhase(state.currentPhase + 1);
                }
            });
            
            backBtn.addEventListener('click', () => {
                if (state.currentPhase > 1) {
                    goToPhase(state.currentPhase - 1);
                }
            });
            
            launchBtn.addEventListener('click', launchRocket);
            
            resetBtn.addEventListener('click', () => {
                location.reload();
            });
        }

        function goToPhase(phaseNum) {
            // Hide all phases
            document.getElementById('phase1').classList.add('hidden');
            document.getElementById('phase2').classList.add('hidden');
            document.getElementById('phase3').classList.add('hidden');
            
            // Update dots
            document.querySelectorAll('.phase-dot').forEach(dot => dot.classList.remove('active'));
            
            // Show target phase
            state.currentPhase = phaseNum;
            document.getElementById(`phase${phaseNum}`).classList.remove('hidden');
            document.getElementById(`dot-${phaseNum}`).classList.add('active');
            
            // Update buttons
            const backBtn = document.getElementById('backBtn');
            const nextBtn = document.getElementById('nextBtn');
            const launchBtn = document.getElementById('launchBtn');
            
            backBtn.classList.toggle('hidden', phaseNum === 1);
            nextBtn.classList.toggle('hidden', phaseNum !== 1);
            launchBtn.classList.toggle('hidden', phaseNum !== 2 || !state.testedReaction);
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
